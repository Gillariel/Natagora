<ui:composition template="/WEB-INF/template/layout.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core">

    <!-- All content outside an ui:define will be considered as a comment and not be rendered -->

    <ui:define name="title">
        Pending Media Management
    </ui:define>

    <!-- Custom CSS for this page -->
    <ui:define name="css">
        <h:outputStylesheet name="plugins/bower_components/gallery/css/animated-masonry-gallery.css"></h:outputStylesheet>
        <h:outputStylesheet name="plugins/bower_components/fancybox/ekko-lightbox.min.css"></h:outputStylesheet>
    </ui:define>

    <ui:define name="content">
        <div class="row">
            <div class="col-md-12">
                <div class="white-box">
                    <h3 class="box-title">Pending Gallery</h3>
                    <div id="gallery">
                        <div id="gallery-header">
                            <div id="gallery-header-center">
                                <div id="gallery-header-center-left">
                                    <div class="gallery-header-center-right-links" id="filter-all">All</div>
                                    <div class="gallery-header-center-right-links" id="filter-Photo">Photo</div>
                                    <div class="gallery-header-center-right-links" id="filter-Audio">Audio</div>
                                    <div class="gallery-header-center-right-links" id="filter-Video">Video</div>
                                </div>
                            </div>
                        </div>
                        <div id="gallery-content">
                            <div id="gallery-content-center">
                                <c:forEach var="m" items="#{pendingHandler.all()}">
                                    <a href="#{m.url}" id="#{m.id}" data-toggle="lightbox" data-gallery="multiimages" data-title="#{m.name}">
                                        <img src="#{m.url}" class="all #{m.mediaTypeID.type}" alt="gallery" />
                                    </a>
                                </c:forEach>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </ui:define>

    <!-- Custom Script for this page -->
    <ui:define name="js">
        <h:outputScript name="plugins/bower_components/gallery/js/animated-masonry-gallery.js"></h:outputScript>
        <h:outputScript name="plugins/bower_components/gallery/js/jquery.isotope.min.js"></h:outputScript>
        <h:outputScript name="plugins/bower_components/fancybox/ekko-lightbox.min.js"></h:outputScript>
        <script type="text/javascript">
            $(document).ready(function($) {
                // delegate calls to data-toggle="lightbox"
                $(document).delegate('*[data-toggle="lightbox"]:not([data-gallery="navigateTo"])', 'click', function(event) {
                    event.preventDefault();
                    return $(this).ekkoLightbox({
                        footer: '<a href="#" onclick="ajaxValidate(id, false)" class="pull-left "><i class="fa fa-times-circle-o fa-3x text-danger"></i></a><a href="#" onclick="ajaxValidate(id, true)" class="pull-right"><i class="fa fa-check-circle-o fa-3x text-success"></i></a>',
                        onShown: function() {
                            if (window.console) {
                                return console.log('Checking our the events huh?');
                            }
                        },
                        onContentLoaded: function() {
                            var url = $(".img-responsive").attr('src');
                            var id = $('a[href="'+url+'"]').attr("id");
                            alert(id);
                            $(".modal-footer").html('<a href="#" onclick="ajaxValidate(' + id + ', false)" class="pull-left "><i class="fa fa-times-circle-o fa-3x text-danger"></i></a><a href="#" onclick="ajaxValidate(' + id + ', true)" class="pull-right"><i class="fa fa-check-circle-o fa-3x text-success"></i></a>');
                            $(".modal-footer").removeAttr('style');
                        },
                        onNavigate: function(direction, itemIndex) {
                            if (window.console) {
                                return console.log('Navigating ' + direction + '. Current item: ' + itemIndex);
                            }
                        }
                    });
                });
                //Programatically call
                $('#open-image').click(function(e) {
                    e.preventDefault();
                    $(this).ekkoLightbox();
                });
                $('#open-youtube').click(function(e) {
                    e.preventDefault();
                    $(this).ekkoLightbox();
                });
                // navigateTo
                $(document).delegate('*[data-gallery="navigateTo"]', 'click', function(event) {
                    event.preventDefault();
                    var lb;
                    return $(this).ekkoLightbox({
                        onShown: function() {
                            lb = this;
                            $(lb.modal_content).on('click', '.modal-footer a', function(e) {
                                e.preventDefault();
                                lb.navigateTo(2);
                            });
                        }
                    });
                });
            });
            
            function ajaxValidate(id, result) {
                var url = (result) ? 'http://127.0.0.1:8081/NataRest/api/media/validate/' + id
                                        : 'http://127.0.0.1:8081/NataRest/api/media/delete/' + id ;
                $.ajax({
                    url: url,
                    type: 'PUT',
                    //crossDomain: true, 
                    data: { },
                    /*beforeSend: function(xhr) {
                        xhr.setRequestHeader("Access-Control-Allow-Origin", "http://localhost:8080");
                    },*/
                    headers: {
                        //'Access-Control-Allow-Origin': '*',
                        'api-key': "#{globalAjax.apiKey()}"
                    },
                    //xhrFields: {withCredentials: true },
                    dataType: 'json',
                    success: function (data) {
                        alert("Success");
                        console.info(data);
                    },
                    error: function (data) {
                        alert("Error");
                    }
                });
            }
        </script>
    </ui:define>

</ui:composition>

